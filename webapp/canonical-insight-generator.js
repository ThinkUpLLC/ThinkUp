// Generated by IcedCoffeeScript 1.4.0a
(function() {
  var canonical_insights, createInsight, insightTypes, loopThroughInsights, pipeToTemplate;

  pipeToTemplate = function(insight) {
    return "<div class=\"panel panel-default insight " + insight.classes + "\">\n  <div class=\"panel-heading " + insight.heading_classes + "\">\n    <h2 class=\"panel-title\">" + insight.title + "</h2>\n    " + insight.subtitle + "\n    " + insight.header_graphic + "\n  </div>\n  <div class=\"panel-body\">\n    " + insight.hero_image + "\n    " + insight.body + "\n  </div>\n  <div class=\"panel-footer\">\n    <div class=\"insight-metadata\">\n      <i class=\"fa fa-" + insight.network_icon + " icon icon-network\"></i>\n      <a class=\"permalink\" href=\"#\">" + insight.date + "</a>\n    </div>\n    <div class=\"share-menu\"><a class=\"share-button\" href=\"#\"><i class=\"fa fa-share-square-o icon icon-share\"></i></a></div>\n  </div>\n</div>";
  };

  createInsight = function(data) {
    var body_content, cd, heading_classes, hg, insight_classes, td, template_data, tweet;
    cd = data.content;
    heading_classes = [];
    insight_classes = [];
    td = template_data = {
      title: cd.title,
      network_icon: data.network_icon,
      date: data.date
    };
    td.subtitle = cd.subtitle != null ? "<p class=\"panel-subtitle\">" + cd.subtitle + "</p>" : "";
    if (cd.header_graphic != null) {
      hg = cd.header_graphic;
      heading_classes.push("panel-heading-illustrated");
      td.header_graphic = "<img src=\"" + hg.asset_url + "\" alt=\"" + hg.alt_text + "\" width=\"50\" height=\"50\" class=\"img-circle userpic userpic-featured\">";
    } else {
      td.header_graphic = "";
    }
    if (cd.body.hero_image != null) {
      td.hero_image = "<img src=\"" + cd.body.hero_image.asset_url + "\" alt=\"" + cd.body.hero_image.alt_text + "\" class=\"img-responsive\">";
    } else {
      td.hero_image = "";
    }
    body_content = "";
    if (cd.body.text != null) {
      body_content += "<p>" + cd.body.text + "</p>";
    } else {
      "";
    }
    if (cd.body.action_button != null) {
      body_content += "<a href=\"" + cd.body.action_button.url + "\" class=\"btn btn-default\">" + cd.body.action_button.text + "</a>";
    }
    if (cd.body.tweets != null) {
      if (cd.body.tweets.length === 1) {
        tweet = cd.body.tweets[0];
        body_content += "<div class=\"tweet clearfix\">\n  <img src=\"" + tweet.user.profile_image_url + "\" alt=\"" + tweet.user.name + "\" width=\"60\" height=\"60\" class=\"img-circle pull-left\">\n  <p class=\"byline\"><strong>" + tweet.user.name + "</strong> <span class=\"username\">" + tweet.user.screenname + "</span></p>\n  <p class=\"tweet-body\">" + tweet.html + "</p>\n</div>";
      }
    }
    if (body_content.length) {
      td.body = "<div class=\"panel-body-inner\">" + body_content + "</div>";
    } else {
      td.body = "";
    }
    insight_classes.push("insight-" + (data.insight_type.replace("_", "-")));
    switch (data.insight_type) {
      case "editorial":
        insight_classes.push("insight-hero");
        break;
      case "time_machine":
        insight_classes.push("insight-historical");
    }
    td.heading_classes = heading_classes.join(" ");
    td.classes = insight_classes.join(" ");
    console.log(td);
    return pipeToTemplate(td);
  };

  loopThroughInsights = function(insightsArray) {
    var date_string, html, insight, _i, _len;
    date_string = null;
    html = "";
    for (_i = 0, _len = insightsArray.length; _i < _len; _i++) {
      insight = insightsArray[_i];
      if (date_string === null) {
        date_string = insight.date;
        html += "<div class=\"date-group date-group-today\">\n  <div class=\"date-marker\">\n    <div class=\"relative\">Today</div>\n    <div class=\"absolute\">" + insight.date + ", 2013</div>\n  </div>";
        html += createInsight(insight);
      } else if (date_string === insight.date) {
        html += createInsight(insight);
      } else {
        date_string = insight.date;
        html += "</div>\n<div class=\"date-group\">\n  <div class=\"date-marker\">\n    <div class=\"relative\">Yesterday</div>\n    <div class=\"absolute\">" + insight.date + ", 2013</div>\n  </div>";
        html += createInsight(insight);
      }
      console.log(createInsight(insight));
    }
    html += "</div>";
    return $(".stream").append(html);
  };

  canonical_insights = [
    {
      insight_type: "biggest_fan",
      network_icon: "facebook-square",
      date: "Nov 12",
      content: {
        title: "Jennifer is your biggest fan from the past week",
        subtitle: "She liked 23 of your status updates!",
        header_graphic: {
          asset_url: "https://www.thinkup.com/join/assets/img/hilary-mason.jpg",
          alt_text: "Hillary Mason"
        },
        body: {
          hero_image: null,
          text: "Let Jennifer know you appreciate her support.",
          action_button: {
            text: "Send message",
            url: "#"
          }
        }
      }
    }, {
      insight_type: "editorial",
      network_icon: "twitter-square",
      date: "Nov 12",
      content: {
        title: "You tweeted about #snowpocalypse â€” need to warm up?",
        subtitle: "Your friends @billjones and @vanessegg had the best weather of anyone you talked to yesterday. Maybe ask them to tweet you a picture?",
        body: {
          hero_image: {
            asset_url: "http://distilleryimage0.ak.instagram.com/5603f97068cc11e29ca422000a1fb149_7.jpg",
            alt_text: "A pretty beach"
          }
        }
      }
    }, {
      insight_type: "time_machine",
      network_icon: "twitter-square",
      date: "Nov 11",
      content: {
        title: "On this day last year &hellip;",
        subtitle: "This tweet you wrote got 32 favorites",
        body: {
          tweets: [
            {
              user: {
                name: "Matt Jacobs",
                screen_name: "capndesign",
                profile_image_url: "https://pbs.twimg.com/profile_images/14177592/twitter_bigger.jpg"
              },
              html: "I just called in with the <a href=\"https://twitter.com/search?q=%23Halo4Flu\">#Halo4Flu</a>. I feel like it's gonna last all week."
            }
          ]
        }
      }
    }
  ];

  insightTypes = {
    biggest_fan: {
      theme: "default",
      is_historical: false
    }
  };

  $(function() {
    return loopThroughInsights(canonical_insights);
  });

}).call(this);
